<?xml version="1.0" encoding="utf-8"?>
<configuration>

  <appSettings>
    <add key="manual-test-broker-hostname" value="localhost"/>
    <add key="manual-test-broker-port" value="5672"/>
    <add key="manual-test-broker-protocol" value="AMQP_0_9_1"/>
  </appSettings>
  
  <system.diagnostics>
    <sources>
      <source name="System.ServiceModel.MessageLogging" switchValue="Verbose">
        <listeners>
          <add name="xml" type="System.Diagnostics.XmlWriterTraceListener"
          initializeData="message.log" />
        </listeners>
      </source>
    </sources>
    <trace autoflush="true"/>
  </system.diagnostics>


  <system.serviceModel>
    <services>
      <service name="voxelworld.WorldServiceImpl" 
        behaviorConfiguration="metadataSupport">
        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8888/WorldService/"/>
        <!--    <add baseAddress="net.tcp://localhost:8080/WorldService/"/>-->
          </baseAddresses>
        </host>
        <endpoint 
          address="World"
          binding="basicHttpBinding"
          bindingConfiguration="bindingSettings"
          contract="voxelworld.IWorldService"/>
      </service>  
      
      <service name="voxelworld.RabbitMqService"
        behaviorConfiguration="rabbitBehavior">
        <host>
          <baseAddresses>
            <add baseAddress = "soap.amqp:///" />
            <!-- <add baseAddress = "http://localhost:8080/" /> -->
          </baseAddresses>
        </host>
        <endpoint
          address="Rabbit"
          binding="rabbitMQBinding"
          bindingConfiguration="rabbitMQConfig"
          contract="voxelworld.IRabbitMqService"/>
      </service>    
    </services>
    
    <client>
        <endpoint name="HttpWorldEndpoint"
          address="http://localhost:8888/WorldService/World" 
          binding="basicHttpBinding"
          bindingConfiguration="bindingSettings"
          contract="voxelworld.IWorldService"/>

      <endpoint name="ServiceOverRabbit"
        address="soap.amqp:///ConfigTest" 
        binding="rabbitMQBinding" 
        bindingConfiguration="rabbitMQConfig" 
        contract="voxelworld.IRabbitMqService"/>
    </client>
    
    <bindings>
      <basicHttpBinding>
        <binding name="bindingSettings" />
        <!-- messageEncoding="Mtom"/> -->
      </basicHttpBinding>

      <rabbitMQBinding>
        <binding name="rabbitMQConfig" 
          broker="amq://localhost:5672/"
          oneWay="true" 
          version="AMQP_0_9_1" />
      </rabbitMQBinding>
    </bindings>
    
    <extensions>
      <bindingExtensions>
        <add 
          name="rabbitMQBinding" 
          type="RabbitMQ.ServiceModel.RabbitMQBindingSection, RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral, PublicKeyToken=null"/>
      </bindingExtensions>
    </extensions>
    
    <behaviors>
      <serviceBehaviors>
        <behavior name="metadataSupport">
          <!-- Enables the IMetadataExchange endpoint in services that -->
          <!-- use "metadataSupport" in their behaviorConfiguration attribute. -->
          <!-- In addition, the httpGetEnabled and httpGetUrl attributes publish -->
          <!-- Service metadata for retrieval by HTTP/GET at the address -->
          <!-- "http://localhost:8080/ServiceMetadata?wsdl" -->
          <serviceMetadata httpGetEnabled="true" httpGetUrl=""/>
          <serviceDebug includeExceptionDetailInFaults="true" />
        </behavior>
        
        <behavior name="rabbitBehavior">
        </behavior>
        
      </serviceBehaviors>
    </behaviors>
    
    <serviceHostingEnvironment multipleSiteBindingsEnabled="true" />
    <diagnostics>
      <messageLogging logEntireMessage="true"
        maxMessagesToLog="300"
        logMessagesAtServiceLevel="false"
        logMalformedMessages="true"
        logMessagesAtTransportLevel="true"/>
    </diagnostics>
  </system.serviceModel>
</configuration>
